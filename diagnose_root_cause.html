<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ì›ì²œì  ì›ì¸ ì§„ë‹¨</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .section {
            background: #252526;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #007acc;
        }
        h2 { color: #4ec9b0; }
        h3 { color: #dcdcaa; }
        .error { color: #f48771; font-weight: bold; }
        .success { color: #4ec9b0; font-weight: bold; }
        .warning { color: #ce9178; font-weight: bold; }
        pre {
            background: #1e1e1e;
            padding: 15px;
            border: 1px solid #3c3c3c;
            overflow-x: auto;
            color: #d4d4d4;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #3c3c3c;
        }
        th { background: #2d2d30; color: #4ec9b0; }
        .diff { background: #4a1f1f; }
        iframe {
            width: 100%;
            height: 200px;
            border: 2px solid #007acc;
            margin: 10px 0;
            background: white;
        }
    </style>
</head>
<body>
    <h1>ğŸ” í—¤ë” ì°¨ì´ ì›ì²œì  ì›ì¸ ë¶„ì„</h1>

    <div class="section">
        <h2>1. ì‹¤ì‹œê°„ ë Œë”ë§ ë¹„êµ</h2>
        <h3>INDEX.HTML í—¤ë”:</h3>
        <iframe id="index-frame" src="/index.html"></iframe>
        <h3>ì œí’ˆ í˜ì´ì§€ í—¤ë”:</h3>
        <iframe id="product-frame" src="/products/gm-900s.html"></iframe>
    </div>

    <div class="section">
        <h2>2. ê³„ì‚°ëœ CSS ê°’ ë¹„êµ</h2>
        <div id="computed-styles"></div>
    </div>

    <div class="section">
        <h2>3. ì ìš©ëœ ëª¨ë“  CSS ê·œì¹™</h2>
        <div id="all-css-rules"></div>
    </div>

    <div class="section">
        <h2>4. HTML êµ¬ì¡° ë¹„êµ</h2>
        <div id="html-structure"></div>
    </div>

    <div class="section">
        <h2>5. ì›ì²œì  ì›ì¸</h2>
        <div id="root-cause"></div>
    </div>

    <script>
        let indexDoc, productDoc;
        let indexHeader, productHeader;

        function waitForIframes() {
            return new Promise((resolve) => {
                let loadedCount = 0;
                const checkLoaded = () => {
                    loadedCount++;
                    if (loadedCount === 2) {
                        setTimeout(() => {
                            try {
                                indexDoc = document.getElementById('index-frame').contentDocument;
                                productDoc = document.getElementById('product-frame').contentDocument;

                                indexHeader = indexDoc.querySelector('header.header');
                                productHeader = productDoc.querySelector('header.header');

                                resolve();
                            } catch (e) {
                                document.getElementById('root-cause').innerHTML =
                                    '<p class="error">CORS ì˜¤ë¥˜: iframe ë‚´ìš©ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>' +
                                    '<p>localhost:3000ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.</p>';
                            }
                        }, 1000);
                    }
                };

                document.getElementById('index-frame').onload = checkLoaded;
                document.getElementById('product-frame').onload = checkLoaded;
            });
        }

        function getComputedStylesComparison() {
            if (!indexHeader || !productHeader) {
                return '<p class="error">í—¤ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>';
            }

            const elements = [
                { selector: '.logo img', name: 'ë¡œê³  ì´ë¯¸ì§€' },
                { selector: '.dealer-badge', name: 'ë°°ì§€' },
                { selector: '.main-nav a', name: 'ë©”ë‰´ ë§í¬' },
                { selector: '.header-contact', name: 'ì—°ë½ì²˜' }
            ];

            const properties = ['height', 'width', 'font-size', 'padding', 'margin', 'display', 'gap'];

            let html = '<table>';
            html += '<tr><th>ìš”ì†Œ</th><th>ì†ì„±</th><th>INDEX.HTML</th><th>ì œí’ˆ í˜ì´ì§€</th><th>ìƒíƒœ</th></tr>';

            elements.forEach(elem => {
                const indexElem = indexHeader.querySelector(elem.selector);
                const productElem = productHeader.querySelector(elem.selector);

                if (!indexElem || !productElem) {
                    html += `<tr><td colspan="5" class="error">${elem.name}: ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ</td></tr>`;
                    return;
                }

                const indexStyles = window.getComputedStyle(indexElem);
                const productStyles = window.getComputedStyle(productElem);

                properties.forEach(prop => {
                    const indexVal = indexStyles[prop];
                    const productVal = productStyles[prop];
                    const isDifferent = indexVal !== productVal;

                    html += `<tr ${isDifferent ? 'class="diff"' : ''}>`;
                    html += `<td>${elem.name}</td>`;
                    html += `<td>${prop}</td>`;
                    html += `<td>${indexVal}</td>`;
                    html += `<td>${productVal}</td>`;
                    html += `<td>${isDifferent ? '<span class="error">âœ— ë‹¤ë¦„</span>' : '<span class="success">âœ“ ê°™ìŒ</span>'}</td>`;
                    html += '</tr>';
                });
            });

            html += '</table>';
            return html;
        }

        function getAllCSSRules() {
            if (!indexDoc || !productDoc) return '<p class="error">ë¬¸ì„œë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>';

            let html = '<h3>INDEX.HTMLì˜ CSS ê·œì¹™:</h3><pre>';

            try {
                const indexStyles = indexDoc.styleSheets;
                let indexRules = [];

                for (let i = 0; i < indexStyles.length; i++) {
                    try {
                        const rules = indexStyles[i].cssRules || indexStyles[i].rules;
                        for (let j = 0; j < rules.length; j++) {
                            const rule = rules[j];
                            if (rule.cssText && (
                                rule.cssText.includes('.header') ||
                                rule.cssText.includes('.logo') ||
                                rule.cssText.includes('.dealer-badge')
                            )) {
                                indexRules.push(rule.cssText);
                            }
                        }
                    } catch (e) {
                        // Cross-origin stylesheet
                    }
                }

                html += indexRules.slice(0, 10).join('\n\n');
                html += `\n\n... (ì´ ${indexRules.length}ê°œ ê·œì¹™)`;
            } catch (e) {
                html += 'CSS ê·œì¹™ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + e.message;
            }

            html += '</pre>';

            html += '<h3>ì œí’ˆ í˜ì´ì§€ì˜ CSS ê·œì¹™:</h3><pre>';

            try {
                const productStyles = productDoc.styleSheets;
                let productRules = [];

                for (let i = 0; i < productStyles.length; i++) {
                    try {
                        const rules = productStyles[i].cssRules || productStyles[i].rules;
                        for (let j = 0; j < rules.length; j++) {
                            const rule = rules[j];
                            if (rule.cssText && (
                                rule.cssText.includes('.header') ||
                                rule.cssText.includes('.logo') ||
                                rule.cssText.includes('.dealer-badge')
                            )) {
                                productRules.push(rule.cssText);
                            }
                        }
                    } catch (e) {
                        // Cross-origin stylesheet
                    }
                }

                html += productRules.slice(0, 10).join('\n\n');
                html += `\n\n... (ì´ ${productRules.length}ê°œ ê·œì¹™)`;
            } catch (e) {
                html += 'CSS ê·œì¹™ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + e.message;
            }

            html += '</pre>';

            return html;
        }

        function findRootCause() {
            if (!indexHeader || !productHeader) {
                return '<p class="error">í—¤ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>';
            }

            const indexLogo = indexHeader.querySelector('.logo img');
            const productLogo = productHeader.querySelector('.logo img');
            const indexBadge = indexHeader.querySelector('.dealer-badge');
            const productBadge = productHeader.querySelector('.dealer-badge');

            let issues = [];

            // ë¡œê³  í¬ê¸° ë¹„êµ
            if (indexLogo && productLogo) {
                const indexLogoHeight = window.getComputedStyle(indexLogo).height;
                const productLogoHeight = window.getComputedStyle(productLogo).height;

                if (indexLogoHeight !== productLogoHeight) {
                    issues.push({
                        type: 'CRITICAL',
                        element: 'ë¡œê³  ì´ë¯¸ì§€',
                        property: 'height',
                        index: indexLogoHeight,
                        product: productLogoHeight,
                        reason: this.findWhyDifferent(indexLogo, productLogo, 'height')
                    });
                }
            }

            // ë°°ì§€ í¬ê¸° ë¹„êµ
            if (indexBadge && productBadge) {
                const indexFontSize = window.getComputedStyle(indexBadge).fontSize;
                const productFontSize = window.getComputedStyle(productBadge).fontSize;

                if (indexFontSize !== productFontSize) {
                    issues.push({
                        type: 'CRITICAL',
                        element: 'ë°°ì§€',
                        property: 'font-size',
                        index: indexFontSize,
                        product: productFontSize,
                        reason: this.findWhyDifferent(indexBadge, productBadge, 'font-size')
                    });
                }

                const indexPadding = window.getComputedStyle(indexBadge).padding;
                const productPadding = window.getComputedStyle(productBadge).padding;

                if (indexPadding !== productPadding) {
                    issues.push({
                        type: 'CRITICAL',
                        element: 'ë°°ì§€',
                        property: 'padding',
                        index: indexPadding,
                        product: productPadding,
                        reason: this.findWhyDifferent(indexBadge, productBadge, 'padding')
                    });
                }
            }

            let html = '<h3>ë°œê²¬ëœ ë¬¸ì œ:</h3>';

            if (issues.length === 0) {
                html += '<p class="success">ë¬¸ì œê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì‚­ì œí•˜ì„¸ìš”.</p>';
            } else {
                html += '<table>';
                html += '<tr><th>ì‹¬ê°ë„</th><th>ìš”ì†Œ</th><th>ì†ì„±</th><th>INDEX</th><th>ì œí’ˆ</th><th>ì›ì¸</th></tr>';

                issues.forEach(issue => {
                    html += '<tr class="diff">';
                    html += `<td class="error">${issue.type}</td>`;
                    html += `<td>${issue.element}</td>`;
                    html += `<td>${issue.property}</td>`;
                    html += `<td>${issue.index}</td>`;
                    html += `<td>${issue.product}</td>`;
                    html += `<td>${issue.reason}</td>`;
                    html += '</tr>';
                });

                html += '</table>';
            }

            return html;
        }

        async function runDiagnosis() {
            try {
                await waitForIframes();

                document.getElementById('computed-styles').innerHTML =
                    '<p class="warning">ë¶„ì„ ì¤‘...</p>';

                setTimeout(() => {
                    document.getElementById('computed-styles').innerHTML = getComputedStylesComparison();
                    document.getElementById('all-css-rules').innerHTML = getAllCSSRules();
                    document.getElementById('root-cause').innerHTML = findRootCause();
                }, 500);

            } catch (e) {
                document.getElementById('root-cause').innerHTML =
                    `<p class="error">ì˜¤ë¥˜: ${e.message}</p>`;
            }
        }

        runDiagnosis();
    </script>
</body>
</html>
